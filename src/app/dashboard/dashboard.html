<div class="dashboard">
  <!-- Header -->
  <header class="dashboard-header">
    <div>
      <h1>Dashboard</h1>
      <p class="header-subtitle">Raw Material E-Portal Analytics</p>
    </div>
    <div class="header-actions">
      <div class="current-date">
        {{ currentDate }}
      </div>
      <button class="refresh-btn" (click)="refreshData()" [disabled]="loading">
        <svg class="refresh-icon" [class.spinning]="loading" width="16" height="16" viewBox="0 0 24 24">
          <path fill="currentColor" d="M17.65 6.35C16.2 4.9 14.21 4 12 4c-4.42 0-7.99 3.58-7.99 8s3.57 8 7.99 8c3.73 0 6.84-2.55 7.73-6h-2.08c-.82 2.33-3.04 4-5.65 4-3.31 0-6-2.69-6-6s2.69-6 6-6c1.66 0 3.14.69 4.22 1.78L13 11h7V4l-2.35 2.35z"/>
        </svg>
        {{ loading ? 'Loading...' : 'Refresh' }}
      </button>
    </div>
  </header>

  <!-- Show loading only briefly, then show data -->
  <div *ngIf="!loading || dataLoaded">
    <!-- Stats Grid -->
    <div class="stats-grid" *ngIf="statCards.length > 0">
      <div *ngFor="let stat of statCards" class="stat-card">
        <div class="stat-card-header">
          <div class="stat-icon" [class]="'icon-' + stat.color">
            {{ stat.icon }}
          </div>
          <div class="stat-title">{{ stat.title }}</div>
        </div>
        <div class="stat-value">{{ stat.value }}</div>
        <div class="stat-description">{{ stat.description }}</div>
        <div class="stat-border" [class]="'border-' + stat.color"></div>
      </div>
    </div>

    <!-- Analytics Section -->
    <div class="analytics-section" *ngIf="reportData.totalTables > 0">
      <div class="analytics-header">
        <h2>Analytics</h2>
        <div class="time-filter">
          <select class="filter-select" (change)="onFilterChange($event)" [disabled]="loading">
            <option value="week">This Week</option>
            <option value="month" selected>This Month</option>
            <option value="quarter">This Quarter</option>
          </select>
        </div>
      </div>

      <div class="analytics-grid">
        <!-- Status Distribution -->
        <div class="analytics-card">
          <div class="card-header">
            <h3>Table Status</h3>
            <div class="card-subtitle">Distribution of all tables</div>
          </div>
          <div class="distribution-container">
            <div class="distribution-chart">
              <div class="chart-slice approved" [style.width]="getPercentage(reportData.approvedTables, totalTables) + '%'">
                <div class="slice-label">{{ reportData.approvedTables }}</div>
              </div>
              <div class="chart-slice pending" [style.width]="getPercentage(reportData.pendingApprovals, totalTables) + '%'">
                <div class="slice-label">{{ reportData.pendingApprovals }}</div>
              </div>
              <div class="chart-slice rejected" [style.width]="getPercentage(reportData.rejectedTables, totalTables) + '%'">
                <div class="slice-label">{{ reportData.rejectedTables }}</div>
              </div>
            </div>
            <div class="distribution-legend">
              <div class="legend-item">
                <span class="legend-color approved"></span>
                <span class="legend-label">Approved</span>
                <span class="legend-percentage">{{ getPercentage(reportData.approvedTables, totalTables) | number:'1.0-0' }}%</span>
              </div>
              <div class="legend-item">
                <span class="legend-color pending"></span>
                <span class="legend-label">Pending</span>
                <span class="legend-percentage">{{ getPercentage(reportData.pendingApprovals, totalTables) | number:'1.0-0' }}%</span>
              </div>
              <div class="legend-item">
                <span class="legend-color rejected"></span>
                <span class="legend-label">Rejected</span>
                <span class="legend-percentage">{{ getPercentage(reportData.rejectedTables, totalTables) | number:'1.0-0' }}%</span>
              </div>
            </div>
          </div>
        </div>

        <!-- Activity Overview -->
        <div class="analytics-card">
          <div class="card-header">
            <h3>Activity Overview</h3>
            <div class="card-subtitle">Last 7 days</div>
          </div>
          <div class="activity-chart">
            <div class="chart-bars">
              <div *ngFor="let day of activityDays" class="bar-container">
                <div class="bar" [style.height]="day.value * 2 + 'px'" [title]="day.value + ' activities'">
                  <div class="bar-value">{{ day.value }}</div>
                </div>
                <div class="bar-label">{{ day.label }}</div>
              </div>
            </div>
          </div>
          <div class="activity-stats">
            <div class="stat-item">
              <div class="stat-number">{{ totalActivities }}</div>
              <div class="stat-label">Total</div>
            </div>
            <div class="stat-item">
              <div class="stat-number">{{ averageDaily | number:'1.1-1' }}</div>
              <div class="stat-label">Avg/Day</div>
            </div>
            <div class="stat-item">
              <div class="stat-number">{{ peakDay }}</div>
              <div class="stat-label">Peak Day</div>
            </div>
          </div>
        </div>
      </div>
    </div>

    <!-- No Data State -->
    <div *ngIf="!loading && reportData.totalTables === 0" class="no-data-state">
      <div class="no-data-content">
        <div class="no-data-icon">ðŸ“Š</div>
        <h3>No Data Available</h3>
        <p>Could not load data from the database. The tables might be empty or there's a connection issue.</p>
        <button class="retry-btn" (click)="refreshData()">Retry Loading</button>
      </div>
    </div>
  </div>

  <!-- Loading Overlay - Positioned to not overlap sidebar -->
  <div *ngIf="loading && !dataLoaded" class="loading-overlay">
    <div class="loading-content">
      <div class="loading-spinner"></div>
      <div class="loading-text">Loading dashboard data...</div>
      <div class="loading-subtext">This may take a few moments</div>
    </div>
  </div>
</div>